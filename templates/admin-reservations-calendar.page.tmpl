{{template "base" .}}

{{define "page-title"}}
Reservations Calendar
{{end}}

{{define "content"}}

{{$selectedDay := .Data.selectedDay}}

<div class="row">

    <!-- Sidebar Calendar -->
    <div class="col-md-3">
        <div class="sidebar-calendar">

            <div class="d-flex justify-content-between align-items-center mb-2">
                <a href="/admin/reservations-calendar?month={{.StringMap.last_month}}&year={{.StringMap.last_month_year}}">‹</a>
                <strong>{{.Data.now | humanDate}}</strong>
                <a href="/admin/reservations-calendar?month={{.StringMap.next_month}}&year={{.StringMap.next_month_year}}">›</a>
            </div>

            <table class="mini-calendar">
                <thead>
                    <tr>
                        <th>S</th><th>M</th><th>T</th><th>W</th><th>T</th><th>F</th><th>S</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Data.calendar}}
                    <tr>
                        {{range .}}
                        <td class="mini-day 
                            {{if .Reservations}}has-reservation{{end}}
                            {{if eq .Day $.Data.now.Day}}today{{end}}
                            {{if eq .Day $selectedDay}}active{{end}}">
                            {{if .Day}}
                            <a href="/admin/reservations-calendar?day={{.Day}}&month={{$.Data.month}}&year={{$.Data.year}}">
                                {{.Day}}
                            </a>
                            {{end}}
                        </td>
                        {{end}}
                    </tr>
                    {{end}}
                </tbody>
            </table>

            <!-- Booking Editor Panel -->
            <div class="calendar-editor mt-3">
                <h6>Edit Bookings</h6>

                <input type="hidden" id="csrf-token" value="{{.CSRFToken}}">

                <label>Room</label>
                <select id="room-select" class="form-control mb-2">
                    <option value="">Select room</option>
                    {{range .Data.rooms}}
                        <option value="{{.ID}}">{{.RoomName}}</option>
                    {{end}}
                </select>

                <label>Guest Name</label>
                <input id="guest-name" class="form-control mb-2">

                <label>Start Date</label>
                <input id="start-date" type="date" class="form-control mb-2">

                <label>End Date</label>
                <input id="end-date" type="date" class="form-control mb-3">

                <div id="booking-preview" class="mb-2"></div>

                <button id="add-booking" class="btn btn-primary btn-sm w-100 mb-2">
                    Add Booking
                </button>

                <button id="save-calendar" type="button" class="btn btn-success btn-sm w-100 mb-2">
    Save Changes
</button>

<button id="delete-reservation" type="button" class="btn btn-danger btn-sm w-100 mt-2">
    Delete Reservation
</button>


                <div id="delete-confirm-box" class="alert alert-danger d-none mt-2">
                    <strong>Confirm Delete?</strong>
                    <div class="mt-2 d-flex gap-2">
                        <button id="confirm-delete" class="btn btn-danger btn-sm">Yes, Delete</button>
                        <button id="cancel-delete" class="btn btn-secondary btn-sm">Cancel</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Main Booking Panel -->
    <div class="col-md-9">
        <h4>Bookings</h4>

        {{range .Data.calendar}}
        {{range .}}
        {{if eq .Day $selectedDay}}
        <div class="booking-group">
            <strong>Day {{.Day}}</strong>

            {{range .Reservations}}
                <div class="reservation-badge reservation"
                     data-id="{{.ID}}"
                     data-room-id="{{.RoomID}}"
                     data-guest="{{.FirstName}} {{.LastName}}"
                     data-start="{{.StartDate | isoDate}}"
                     data-end="{{.EndDate | isoDate}}">
                    {{.Room.RoomName}} — {{.FirstName}} {{.LastName}}
                </div>
            {{else}}
                <p class="text-muted">No reservations</p>
            {{end}}
        </div>
        {{end}}
        {{end}}
        {{end}}

    </div>
</div>

{{end}}
